@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Identity
@using company_expenses_auth.Data

@inject SignInManager<ApplicationUser> SignInManager
@inject IdentityRedirectManager RedirectManager

@if (externalLogins.Length == 0)
{
    <div class="w-full">
        <button type="button"
            class="w-full flex items-center justify-center gap-3 px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-700 font-medium hover:bg-gray-50 transition disabled:opacity-60 disabled:cursor-not-allowed"
            disabled>
            <span class="material-symbols-outlined" style="font-size: 20px;">search</span>
            <span>Continue with Google</span>
        </button>
    </div>
}
else
{
    <form class="w-full" action="Account/PerformExternalLogin" method="post">
        <AntiforgeryToken />
        <input type="hidden" name="ReturnUrl" value="@ReturnUrl" />
        <div class="space-y-3">
            @foreach (var provider in externalLogins)
            {
                <button type="submit"
                    class="w-full flex items-center justify-center gap-3 px-4 py-2.5 border border-gray-300 rounded-lg bg-white text-gray-700 font-medium hover:bg-gray-50 hover:border-gray-400 transition shadow-sm"
                    name="provider" value="@provider.Name" title="Log in using your @provider.DisplayName account">
                    @if (provider.Name == "Google")
                    {
                        <span class="material-symbols-outlined" style="font-size: 20px;">search</span>
                    }
                    <span>Continue with @provider.DisplayName</span>
                </button>
            }
        </div>
    </form>
}

@code {
    private AuthenticationScheme[] externalLogins = [];

    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; set; }

    protected override async Task OnInitializedAsync()
    {
        externalLogins = (await SignInManager.GetExternalAuthenticationSchemesAsync()).ToArray();
    }
}